<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Simple Noter</title>
    </head>

    <body>
        <!-- This is a comment -->
        <h1>simple-note</h1>
        <p><sub>To make notes, just type in the space below! (Tip: your note is saved every 3 seconds!)</sub></p>
        <br>
        <div id="content"></div>
        <script src="https://unpkg.com/filer/dist/filer.min.js"></script>
        <script>
            const fs = new Filer.FileSystem();
            var nString = "Welcome to simple-noter! Nothing is saved yet, so just type here!"; //init

            var contentDiv = document.getElementById("content");
            var noteDiv = document.createElement("div");
            noteDiv.setAttribute("contenteditable", true);
            noteDiv.id = "note";
            noteDiv.style.background = "#ffff88";
            contentDiv.appendChild(noteDiv);
            
            window.addEventListener("DOMContentLoaded", (event) => {
                console.log("DOM fully loaded and parsed");
                fs.readFile("/note.txt", 'utf8', function(err, data) {
                    if(err) {
                        console.log("Document not found/ could not be read. New file will be created upon save.");
                        noteDiv.textContent = nString;
                    }

                    if(data) {
                        noteDiv.textContent = data;
                        console.log("Document loaded.");
                    }
                });

                var intervalID = window.setInterval(autoSave, 3000); //save every 3 seconds

                function autoSave() {
                    newNString = document.getElementById("note").textContent;
                    fs.writeFile("/note.txt", newNString, function (err) {
                        if (err) throw err;
                        else console.log("Document auto-saved: " + newNString);
                    });
                }
            });
        </script>
    </body>
</html>
